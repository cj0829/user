UE.plugins.defaultfilter=function(){var a=this;a.setOpt({allowDivTransToP:true,disabledTableInTable:true,rgb2Hex:true});a.addInputRule(function(c){var d=this.options.allowDivTransToP;var e;function b(f){while(f&&f.type=="element"){if(f.tagName=="td"){return true}f=f.parentNode}return false}c.traversal(function(h){if(h.type=="element"){if(!dtd.$cdata[h.tagName]&&a.options.autoClearEmptyNode&&dtd.$inline[h.tagName]&&!dtd.$empty[h.tagName]&&(!h.attrs||utils.isEmptyObject(h.attrs))){if(!h.firstChild()){h.parentNode.removeChild(h)}else{if(h.tagName=="span"&&(!h.attrs||utils.isEmptyObject(h.attrs))){h.parentNode.removeChild(h,true)}}return}switch(h.tagName){case"style":case"script":h.setAttr({cdata_tag:h.tagName,cdata_data:(h.innerHTML()||""),_ue_custom_node_:"true"});h.tagName="div";h.innerHTML("");break;case"a":if(e=h.getAttr("href")){h.setAttr("_href",e)}break;case"img":if(e=h.getAttr("src")){if(/^data:/.test(e)){h.parentNode.removeChild(h);break}}h.setAttr("_src",h.getAttr("src"));break;case"span":if(browser.webkit&&(e=h.getStyle("white-space"))){if(/nowrap|normal/.test(e)){h.setStyle("white-space","");if(a.options.autoClearEmptyNode&&utils.isEmptyObject(h.attrs)){h.parentNode.removeChild(h,true)}}}e=h.getAttr("id");if(e&&/^_baidu_bookmark_/i.test(e)){h.parentNode.removeChild(h)}break;case"p":if(e=h.getAttr("align")){h.setAttr("align");h.setStyle("text-align",e)}utils.each(h.children,function(o){if(o.type=="element"&&o.tagName=="p"){var l=o.nextSibling();h.parentNode.insertAfter(o,h);var m=o;while(l){var k=l.nextSibling();h.parentNode.insertAfter(l,m);m=l;l=k}return false}});if(!h.firstChild()){h.innerHTML(browser.ie?"&nbsp;":"<br/>")}break;case"div":if(h.getAttr("cdata_tag")){break}e=h.getAttr("class");if(e&&/^line number\d+/.test(e)){break}if(!d){break}var g,j=UE.uNode.createElement("p");while(g=h.firstChild()){if(g.type=="text"||!UE.dom.dtd.$block[g.tagName]){j.appendChild(g)}else{if(j.firstChild()){h.parentNode.insertBefore(j,h);j=UE.uNode.createElement("p")}else{h.parentNode.insertBefore(g,h)}}}if(j.firstChild()){h.parentNode.insertBefore(j,h)}h.parentNode.removeChild(h);break;case"dl":h.tagName="ul";break;case"dt":case"dd":h.tagName="li";break;case"li":var f=h.getAttr("class");if(!f||!/list\-/.test(f)){h.setAttr()}var i=h.getNodesByTagName("ol ul");UE.utils.each(i,function(k){h.parentNode.insertAfter(k,h)});break;case"td":case"th":case"caption":if(!h.children||!h.children.length){h.appendChild(browser.ie11below?UE.uNode.createText(" "):UE.uNode.createElement("br"))}break;case"table":if(a.options.disabledTableInTable&&b(h)){h.parentNode.insertBefore(UE.uNode.createText(h.innerText()),h);h.parentNode.removeChild(h)}}}})});a.addOutputRule(function(b){var c;b.traversal(function(d){if(d.type=="element"){if(a.options.autoClearEmptyNode&&dtd.$inline[d.tagName]&&!dtd.$empty[d.tagName]&&(!d.attrs||utils.isEmptyObject(d.attrs))){if(!d.firstChild()){d.parentNode.removeChild(d)}else{if(d.tagName=="span"&&(!d.attrs||utils.isEmptyObject(d.attrs))){d.parentNode.removeChild(d,true)}}return}switch(d.tagName){case"div":if(c=d.getAttr("cdata_tag")){d.tagName=c;d.appendChild(UE.uNode.createText(d.getAttr("cdata_data")));d.setAttr({cdata_tag:"",cdata_data:"",_ue_custom_node_:""})}break;case"a":if(c=d.getAttr("_href")){d.setAttr({href:utils.html(c),_href:""})}break;break;case"span":c=d.getAttr("id");if(c&&/^_baidu_bookmark_/i.test(c)){d.parentNode.removeChild(d)}if(a.getOpt("rgb2Hex")){var e=d.getAttr("style");if(e){d.setAttr("style",e.replace(/rgba?\(([\d,\s]+)\)/g,function(f,j){var k=j.split(",");if(k.length>3){return""}j="#";for(var h=0,g;g=k[h++];){g=parseInt(g.replace(/[^\d]/gi,""),10).toString(16);j+=g.length==1?"0"+g:g}return j.toUpperCase()}))}}break;case"img":if(c=d.getAttr("_src")){d.setAttr({src:d.getAttr("_src"),_src:""})}}}})})};UE.commands.inserthtml={execCommand:function(b,i,q){var v=this,k,l;if(!i){return}if(v.fireEvent("beforeinserthtml",i)===true){return}k=v.selection.getRange();l=k.document.createElement("div");l.style.display="inline";if(!q){var r=UE.htmlparser(i);if(v.options.filterRules){UE.filterNode(r,v.options.filterRules)}v.filterInputRule(r);i=r.toHtml()}l.innerHTML=utils.trim(i);if(!k.collapsed){var u=k.startContainer;if(domUtils.isFillChar(u)){k.setStartBefore(u)}u=k.endContainer;if(domUtils.isFillChar(u)){k.setEndAfter(u)}k.txtToElmBoundary();if(k.endContainer&&k.endContainer.nodeType==1){u=k.endContainer.childNodes[k.endOffset];if(u&&domUtils.isBr(u)){k.setEndAfter(u)}}if(k.startOffset==0){u=k.startContainer;if(domUtils.isBoundaryNode(u,"firstChild")){u=k.endContainer;if(k.endOffset==(u.nodeType==3?u.nodeValue.length:u.childNodes.length)&&domUtils.isBoundaryNode(u,"lastChild")){v.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";k.setStart(v.body.firstChild,0).collapse(true)}}}!k.collapsed&&k.deleteContents();if(k.startContainer.nodeType==1){var d=k.startContainer.childNodes[k.startOffset],n;if(d&&domUtils.isBlockElm(d)&&(n=d.previousSibling)&&domUtils.isBlockElm(n)){k.setEnd(n,n.childNodes.length).collapse();while(d.firstChild){n.appendChild(d.firstChild)}domUtils.remove(d)}}}var d,h,n,t,c=0,a;if(k.inFillChar()){d=k.startContainer;if(domUtils.isFillChar(d)){k.setStartBefore(d).collapse(true);domUtils.remove(d)}else{if(domUtils.isFillChar(d,true)){d.nodeValue=d.nodeValue.replace(fillCharReg,"");k.startOffset--;k.collapsed&&k.collapse(true)}}}var j=domUtils.findParentByTagName(k.startContainer,"li",true);if(j){var o,g;while(d=l.firstChild){while(d&&(d.nodeType==3||!domUtils.isBlockElm(d)||d.tagName=="HR")){o=d.nextSibling;k.insertNode(d).collapse();g=d;d=o}if(d){if(/^(ol|ul)$/i.test(d.tagName)){while(d.firstChild){g=d.firstChild;domUtils.insertAfter(j,d.firstChild);j=j.nextSibling}domUtils.remove(d)}else{var f;o=d.nextSibling;f=v.document.createElement("li");domUtils.insertAfter(j,f);f.appendChild(d);g=d;d=o;j=f}}}j=domUtils.findParentByTagName(k.startContainer,"li",true);if(domUtils.isEmptyBlock(j)){domUtils.remove(j)}if(g){k.setStartAfter(g).collapse(true).select(true)}}else{while(d=l.firstChild){if(c){var m=v.document.createElement("p");while(d&&(d.nodeType==3||!dtd.$block[d.tagName])){a=d.nextSibling;m.appendChild(d);d=a}if(m.firstChild){d=m}}k.insertNode(d);a=d.nextSibling;if(!c&&d.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(d)){h=domUtils.findParent(d,function(e){return domUtils.isBlockElm(e)});if(h&&h.tagName.toLowerCase()!="body"&&!(dtd[h.tagName][d.nodeName]&&d.parentNode===h)){if(!dtd[h.tagName][d.nodeName]){n=h}else{t=d.parentNode;while(t!==h){n=t;t=t.parentNode}}domUtils.breakParent(d,n||t);var n=d.previousSibling;domUtils.trimWhiteTextNode(n);if(!n.childNodes.length){domUtils.remove(n)}if(!browser.ie&&(o=d.nextSibling)&&domUtils.isBlockElm(o)&&o.lastChild&&!domUtils.isBr(o.lastChild)){o.appendChild(v.document.createElement("br"))}c=1}}var o=d.nextSibling;if(!l.firstChild&&o&&domUtils.isBlockElm(o)){k.setStart(o,0).collapse(true);break}k.setEndAfter(d).collapse()}d=k.startContainer;if(a&&domUtils.isBr(a)){domUtils.remove(a)}if(domUtils.isBlockElm(d)&&domUtils.isEmptyNode(d)){if(a=d.nextSibling){domUtils.remove(d);if(a.nodeType==1&&dtd.$block[a.tagName]){k.setStart(a,0).collapse(true).shrinkBoundary()}}else{try{d.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(s){k.setStartBefore(d);domUtils.remove(d)}}}try{k.select(true)}catch(s){}}setTimeout(function(){k=v.selection.getRange();k.scrollToView(v.autoHeightEnabled,v.autoHeightEnabled?domUtils.getXY(v.iframe).y:0);v.fireEvent("afterinserthtml",i)},200)}};UE.commands.imagefloat={execCommand:function(a,g){var i=this,f=i.selection.getRange();if(!f.collapsed){var d=f.getClosedNode();if(d&&d.tagName=="IMG"){switch(g){case"left":case"right":case"none":var h=d.parentNode,b,c,e;while(dtd.$inline[h.tagName]||h.tagName=="A"){h=h.parentNode}b=h;if(b.tagName=="P"&&domUtils.getStyle(b,"text-align")=="center"){if(!domUtils.isBody(b)&&domUtils.getChildCount(b,function(j){return !domUtils.isBr(j)&&!domUtils.isWhitespace(j)})==1){c=b.previousSibling;e=b.nextSibling;if(c&&e&&c.nodeType==1&&e.nodeType==1&&c.tagName==e.tagName&&domUtils.isBlockElm(c)){c.appendChild(b.firstChild);while(e.firstChild){c.appendChild(e.firstChild)}domUtils.remove(b);domUtils.remove(e)}else{domUtils.setStyle(b,"text-align","")}}f.selectNode(d).select()}domUtils.setStyle(d,"float",g=="none"?"":g);if(g=="none"){domUtils.removeAttributes(d,"align")}break;case"center":if(i.queryCommandValue("imagefloat")!="center"){h=d.parentNode;domUtils.setStyle(d,"float","");domUtils.removeAttributes(d,"align");b=d;while(h&&domUtils.getChildCount(h,function(j){return !domUtils.isBr(j)&&!domUtils.isWhitespace(j)})==1&&(dtd.$inline[h.tagName]||h.tagName=="A")){b=h;h=h.parentNode}f.setStartBefore(b).setCursor(false);h=i.document.createElement("div");h.appendChild(b);domUtils.setStyle(b,"float","");i.execCommand("insertHtml",'<p id="_img_parent_tmp" style="text-align:center">'+h.innerHTML+"</p>");b=i.document.getElementById("_img_parent_tmp");b.removeAttribute("id");b=b.firstChild;f.selectNode(b).select();e=b.parentNode.nextSibling;if(e&&domUtils.isEmptyNode(e)){domUtils.remove(e)}}break}}}},queryCommandValue:function(){var a=this.selection.getRange(),b,c;if(a.collapsed){return"none"}b=a.getClosedNode();if(b&&b.nodeType==1&&b.tagName=="IMG"){c=domUtils.getComputedStyle(b,"float")||b.getAttribute("align");if(c=="none"){c=domUtils.getComputedStyle(b.parentNode,"text-align")=="center"?"center":c}return{left:1,right:1,center:1}[c]?c:"none"}return"none"},queryCommandState:function(){var a=this.selection.getRange(),b;if(a.collapsed){return -1}b=a.getClosedNode();if(b&&b.nodeType==1&&b.tagName=="IMG"){return 0}return -1}};UE.commands.insertimage={execCommand:function(b,a){a=utils.isArray(a)?a:[a];if(!a.length){return}var j=this,g=j.selection.getRange(),d=g.getClosedNode();if(j.fireEvent("beforeinsertimage",a)===true){return}if(d&&/img/i.test(d.tagName)&&(d.className!="edui-faked-video"||d.className.indexOf("edui-upload-video")!=-1||d.className.indexOf("edui-object-video")!=-1)&&!d.getAttribute("word_img")){var e=a.shift();var k=e.floatStyle;delete e.floatStyle;domUtils.setAttributes(d,e);j.execCommand("imagefloat",k);if(a.length>0){g.setStartAfter(d).setCursor(false,true);j.execCommand("insertimage",a)}}else{var f=[],h="",l;l=a[0];if(a.length==1){h='<img src="'+l.src+'" '+(l._src?' _src="'+l._src+'" ':"")+(l.width?'width="'+l.width+'" ':"")+(l.height?' height="'+l.height+'" ':"")+(l.floatStyle=="left"||l.floatStyle=="right"?' style="float:'+l.floatStyle+';"':"")+(l.title&&l.title!=""?' title="'+l.title+'"':"")+(l.border&&l.border!="0"?' border="'+l.border+'"':"")+(l.alt&&l.alt!=""?' alt="'+l.alt+'"':"")+(l.hspace&&l.hspace!="0"?' hspace = "'+l.hspace+'"':"")+(l.vspace&&l.vspace!="0"?' vspace = "'+l.vspace+'"':"")+"/>";if(l.floatStyle=="center"){h='<p style="text-align: center">'+h+"</p>"}f.push(h)}else{for(var c=0;l=a[c++];){h="<p "+(l.floatStyle=="center"?'style="text-align: center" ':"")+'><img src="'+l.src+'" '+(l.width?'width="'+l.width+'" ':"")+(l._src?' _src="'+l._src+'" ':"")+(l.height?' height="'+l.height+'" ':"")+' style="'+(l.floatStyle&&l.floatStyle!="center"?"float:"+l.floatStyle+";":"")+(l.border||"")+'" '+(l.title?' title="'+l.title+'"':"")+" /></p>";f.push(h)}}j.execCommand("insertHtml",f.join(""))}j.fireEvent("afterinsertimage",a)}};UE.plugins.insertcode=function(){var b=this;b.ready(function(){utils.cssRule("pre","pre{margin:.5em 0;padding:.4em .6em;border-radius:8px;background:#f8f8f8;}",b.document)});b.setOpt("insertcode",{as3:"ActionScript3",bash:"Bash/Shell",cpp:"C/C++",css:"Css",cf:"CodeFunction","c#":"C#",delphi:"Delphi",diff:"Diff",erlang:"Erlang",groovy:"Groovy",html:"Html",java:"Java",jfx:"JavaFx",js:"Javascript",pl:"Perl",php:"Php",plain:"Plain Text",ps:"PowerShell",python:"Python",ruby:"Ruby",scala:"Scala",sql:"Sql",vb:"Vb",xml:"Xml"});b.commands.insertcode={execCommand:function(h,f){var j=this,c=j.selection.getRange(),i=domUtils.findParentByTagName(c.startContainer,"pre",true);if(i){i.className="brush:"+f+";toolbar:false;"}else{var e="";if(c.collapsed){e=browser.ie&&browser.ie11below?(browser.version<=8?"&nbsp;":""):"<br/>"}else{var k=c.extractContents();var d=j.document.createElement("div");d.appendChild(k);utils.each(UE.filterNode(UE.htmlparser(d.innerHTML.replace(/[\r\t]/g,"")),j.options.filterTxtRules).children,function(l){if(browser.ie&&browser.ie11below&&browser.version>8){if(l.type=="element"){if(l.tagName=="br"){e+="\n"}else{if(!dtd.$empty[l.tagName]){utils.each(l.children,function(m){if(m.type=="element"){if(m.tagName=="br"){e+="\n"}else{if(!dtd.$empty[l.tagName]){e+=m.innerText()}}}else{e+=m.data}});if(!/\n$/.test(e)){e+="\n"}}}}else{e+=l.data+"\n"}if(!l.nextSibling()&&/\n$/.test(e)){e=e.replace(/\n$/,"")}}else{if(browser.ie&&browser.ie11below){if(l.type=="element"){if(l.tagName=="br"){e+="<br>"}else{if(!dtd.$empty[l.tagName]){utils.each(l.children,function(m){if(m.type=="element"){if(m.tagName=="br"){e+="<br>"}else{if(!dtd.$empty[l.tagName]){e+=m.innerText()}}}else{e+=m.data}});if(!/br>$/.test(e)){e+="<br>"}}}}else{e+=l.data+"<br>"}if(!l.nextSibling()&&/<br>$/.test(e)){e=e.replace(/<br>$/,"")}}else{e+=(l.type=="element"?(dtd.$empty[l.tagName]?"":l.innerText()):l.data);if(!/br\/?\s*>$/.test(e)){if(!l.nextSibling()){return}e+="<br>"}}}})}j.execCommand("inserthtml",'<pre id="coder"class="brush:'+f+';toolbar:false">'+e+"</pre>",true);i=j.document.getElementById("coder");domUtils.removeAttributes(i,"id");var g=i.previousSibling;if(g&&(g.nodeType==3&&g.nodeValue.length==1&&browser.ie&&browser.version==6||domUtils.isEmptyBlock(g))){domUtils.remove(g)}var c=j.selection.getRange();if(domUtils.isEmptyBlock(i)){c.setStart(i,0).setCursor(false,true)}else{c.selectNodeContents(i).select()}}},queryCommandValue:function(){var c=this.selection.getStartElementPath();var d="";utils.each(c,function(f){if(f.nodeName=="PRE"){var e=f.className.match(/brush:([^;]+)/);d=e&&e[1]?e[1]:"";return false}});return d}};b.addInputRule(function(c){utils.each(c.getNodesByTagName("pre"),function(f){var e=f.getNodesByTagName("br");if(e.length){browser.ie&&browser.ie11below&&browser.version>8&&utils.each(e,function(h){var g=UE.uNode.createText("\n");h.parentNode.insertBefore(g,h);h.parentNode.removeChild(h)});return}if(browser.ie&&browser.ie11below&&browser.version>8){return}var d=f.innerText().split(/\n/);f.innerHTML("");utils.each(d,function(g){if(g.length){f.appendChild(UE.uNode.createText(g))}f.appendChild(UE.uNode.createElement("br"))})})});b.addOutputRule(function(c){utils.each(c.getNodesByTagName("pre"),function(e){var d="";utils.each(e.children,function(f){if(f.type=="text"){d+=f.data.replace(/[ ]/g,"&nbsp;").replace(/\n$/,"")}else{if(f.tagName=="br"){d+="\n"}else{d+=(!dtd.$empty[f.tagName]?"":f.innerText())}}});e.innerText(d.replace(/(&nbsp;|\n)+$/,""))})});b.notNeedCodeQuery={help:1,undo:1,redo:1,source:1,print:1,searchreplace:1,fullscreen:1,preview:1,insertparagraph:1,elementpath:1,insertcode:1,inserthtml:1,selectall:1};var a=b.queryCommandState;b.queryCommandState=function(d){var c=this;if(!c.notNeedCodeQuery[d.toLowerCase()]&&c.selection&&c.queryCommandValue("insertcode")){return -1}return UE.Editor.prototype.queryCommandState.apply(this,arguments)};b.addListener("beforeenterkeydown",function(){var c=b.selection.getRange();var f=domUtils.findParentByTagName(c.startContainer,"pre",true);if(f){b.fireEvent("saveScene");if(!c.collapsed){c.deleteContents()}if(!browser.ie||browser.ie9above){var e=b.document.createElement("br"),f;c.insertNode(e).setStartAfter(e).collapse(true);var k=e.nextSibling;if(!k&&(!browser.ie||browser.version>10)){c.insertNode(e.cloneNode(false))}else{c.setStartAfter(e)}f=e.previousSibling;var h;while(f){h=f;f=f.previousSibling;if(!f||f.nodeName=="BR"){f=h;break}}if(f){var m="";while(f&&f.nodeName!="BR"&&new RegExp("^[\\s"+domUtils.fillChar+"]*$").test(f.nodeValue)){m+=f.nodeValue;f=f.nextSibling}if(f.nodeName!="BR"){var l=f.nodeValue.match(new RegExp("^([\\s"+domUtils.fillChar+"]+)"));if(l&&l[1]){m+=l[1]}}if(m){m=b.document.createTextNode(m);c.insertNode(m).setStartAfter(m)}}c.collapse(true).select(true)}else{if(browser.version>8){var i=b.document.createTextNode("\n");var d=c.startContainer;if(c.startOffset==0){var j=d.previousSibling;if(j){c.insertNode(i);var g=b.document.createTextNode(" ");c.setStartAfter(i).insertNode(g).setStart(g,0).collapse(true).select(true)}}else{c.insertNode(i).setStartAfter(i);var g=b.document.createTextNode(" ");d=c.startContainer.childNodes[c.startOffset];if(d&&!/^\n/.test(d.nodeValue)){c.setStartBefore(i)}c.insertNode(g).setStart(g,0).collapse(true).select(true)}}else{var e=b.document.createElement("br");c.insertNode(e);c.insertNode(b.document.createTextNode(domUtils.fillChar));c.setStartAfter(e);f=e.previousSibling;var h;while(f){h=f;f=f.previousSibling;if(!f||f.nodeName=="BR"){f=h;break}}if(f){var m="";while(f&&f.nodeName!="BR"&&new RegExp("^[ "+domUtils.fillChar+"]*$").test(f.nodeValue)){m+=f.nodeValue;f=f.nextSibling}if(f.nodeName!="BR"){var l=f.nodeValue.match(new RegExp("^([ "+domUtils.fillChar+"]+)"));if(l&&l[1]){m+=l[1]}}m=b.document.createTextNode(m);c.insertNode(m).setStartAfter(m)}c.collapse(true).select()}}b.fireEvent("saveScene");return true}});b.addListener("tabkeydown",function(h,f){var e=b.selection.getRange();var i=domUtils.findParentByTagName(e.startContainer,"pre",true);if(i){b.fireEvent("saveScene");if(f.shiftKey){}else{if(!e.collapsed){var c=e.createBookmark();var j=c.start.previousSibling;while(j){if(i.firstChild===j&&!domUtils.isBr(j)){i.insertBefore(b.document.createTextNode("    "),j);break}if(domUtils.isBr(j)){i.insertBefore(b.document.createTextNode("    "),j.nextSibling);break}j=j.previousSibling}var d=c.end;j=c.start.nextSibling;if(i.firstChild===c.start){i.insertBefore(b.document.createTextNode("    "),j.nextSibling)}while(j&&j!==d){if(domUtils.isBr(j)&&j.nextSibling){if(j.nextSibling===d){break}i.insertBefore(b.document.createTextNode("    "),j.nextSibling)}j=j.nextSibling}e.moveToBookmark(c).select()}else{var g=b.document.createTextNode("    ");e.insertNode(g).setStartAfter(g).collapse(true).select(true)}}b.fireEvent("saveScene");return true}});b.addListener("beforeinserthtml",function(i,e){var g=this,c=g.selection.getRange(),h=domUtils.findParentByTagName(c.startContainer,"pre",true);if(h){if(!c.collapsed){c.deleteContents()}var d="";if(browser.ie&&browser.version>8){utils.each(UE.filterNode(UE.htmlparser(e),g.options.filterTxtRules).children,function(k){if(k.type=="element"){if(k.tagName=="br"){d+="\n"}else{if(!dtd.$empty[k.tagName]){utils.each(k.children,function(l){if(l.type=="element"){if(l.tagName=="br"){d+="\n"}else{if(!dtd.$empty[k.tagName]){d+=l.innerText()}}}else{d+=l.data}});if(!/\n$/.test(d)){d+="\n"}}}}else{d+=k.data+"\n"}if(!k.nextSibling()&&/\n$/.test(d)){d=d.replace(/\n$/,"")}});var f=g.document.createTextNode(utils.html(d.replace(/&nbsp;/g," ")));c.insertNode(f).selectNode(f).select()}else{var j=g.document.createDocumentFragment();utils.each(UE.filterNode(UE.htmlparser(e),g.options.filterTxtRules).children,function(k){if(k.type=="element"){if(k.tagName=="br"){j.appendChild(g.document.createElement("br"))}else{if(!dtd.$empty[k.tagName]){utils.each(k.children,function(l){if(l.type=="element"){if(l.tagName=="br"){j.appendChild(g.document.createElement("br"))}else{if(!dtd.$empty[k.tagName]){j.appendChild(g.document.createTextNode(utils.html(l.innerText().replace(/&nbsp;/g," "))))}}}else{j.appendChild(g.document.createTextNode(utils.html(l.data.replace(/&nbsp;/g," "))))}});if(j.lastChild.nodeName!="BR"){j.appendChild(g.document.createElement("br"))}}}}else{j.appendChild(g.document.createTextNode(utils.html(k.data.replace(/&nbsp;/g," "))))}if(!k.nextSibling()&&j.lastChild.nodeName=="BR"){j.removeChild(j.lastChild)}});c.insertNode(j).select()}return true}});b.addListener("keydown",function(g,d){var f=this,i=d.keyCode||d.which;if(i==40){var c=f.selection.getRange(),h,j=c.startContainer;if(c.collapsed&&(h=domUtils.findParentByTagName(c.startContainer,"pre",true))&&!h.nextSibling){var e=h.lastChild;while(e&&e.nodeName=="BR"){e=e.previousSibling}if(e===j||c.startContainer===h&&c.startOffset==h.childNodes.length){f.execCommand("insertparagraph");domUtils.preventDefault(d)}}}});b.addListener("delkeydown",function(e,d){var c=this.selection.getRange();c.txtToElmBoundary(true);var g=c.startContainer;if(domUtils.isTagNode(g,"pre")&&c.collapsed&&domUtils.isStartInblock(c)){var f=b.document.createElement("p");domUtils.fillNode(b.document,f);g.parentNode.insertBefore(f,g);domUtils.remove(g);c.setStart(f,0).setCursor(false,true);domUtils.preventDefault(d);return true}})};